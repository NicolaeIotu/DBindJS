var nonWindow=typeof window==="undefined",nodeEnv=typeof require!=="undefined";var dbind=function(){var c,f,m,e=arguments.length,d=arguments[0];if(e===0){throw new TypeError("Expecting at least an argument.")}else{if(e===1){if(typeof d!=="object"){throw new TypeError("Expecting at least an argument.")}else{if(nonWindow){c=this||dbind}else{c=this===window?dbind:this||dbind}f=d;m=dbind.prototype}}else{if(e>=2){var a=arguments[1];if(typeof d!=="object"){throw new TypeError("First argument must be an object.")}else{if(typeof a!=="object"){throw new TypeError("The second argument must be an object.")}else{if(!Object.isExtensible(d)||Object.isFrozen(d)||Object.isSealed(d)){throw new TypeError("Make sure the target object is extensible, not frozen and not sealed.")}else{c=d;f=a;m=dbind.prototype}}}}}}var l=Object.keys(f),k=l.length;if(k===0){throw new TypeError("Binding descriptor object is empty, or properties are not enumerable.")}else{var j=false,g=0,h,b;while(g<l.length){if(j){h=l[g];b=f[h];if(!Object.prototype.hasOwnProperty.call(c,"propstore")||!Object.prototype.hasOwnProperty.call(c,"settings")){m.defaultRuntime(c)}if(typeof b==="function"){m.addData(c,h,b,l)}else{m.addData(c,h,b)}g++}else{if(typeof f[l[g]]==="function"){j=true;g=0}else{g++}}}if(!j){for(g=0;g<k;g++){h=l[g];if(!Object.prototype.hasOwnProperty.call(c.bindstore,h)){return}c.bindstore[h]=f[h]}if(c.settings.pause){return}if(c.settings.mergeUpdates){m.runUpdateQueue(c)}}}};dbind.prototype=Object.create(Object.prototype);dbind.prototype.constructor=dbind;(function(){Object.defineProperty(this,"explicitDefaults",{configurable:false,enumerable:false,get:function(){return(function(){return({value:arguments[0],configurable:false,enumerable:false,writable:false})})}});Object.defineProperty(this,"explicitNonConfigurable",{configurable:false,enumerable:false,get:function(){return(function(){return({value:arguments[0],configurable:false,enumerable:true,writable:true})})}});Object.defineProperties(this,{storeMemberKeys:this.explicitDefaults((["dependencies","previousValue","value"]).sort().toString())});Object.defineProperties(this,{defaultRuntime:{configurable:false,enumerable:false,get:function(){return(function(){Object.defineProperties(arguments[0],{settings:this.explicitNonConfigurable({mergeUpdates:true,pause:false}),updateQueue:this.explicitNonConfigurable([]),bindstore:this.explicitNonConfigurable({}),propstore:this.explicitNonConfigurable({})})})}},runUpdateQueue:{configurable:false,enumerable:false,get:function(){return(function(){var c=arguments[0];if(!(c.updateQueue instanceof Array)){throw new TypeError("Error with 'runUpdateQueue': unexpected format for 'updateQueue'")}var a=c.updateQueue.length;for(var b=0;b<a;b++){c.updateQueue.shift()()}})}},addData:{configurable:false,enumerable:false,get:function(){return(function(){var g,a,d,f,c,e=arguments.length===4;function b(){throw new TypeError("@addData")}if((typeof arguments[0]==="object"||arguments[0]===dbind)&&typeof arguments[1]==="string"){g=arguments[0];if(Object.prototype.hasOwnProperty.call(g,"propstore")&&Object.prototype.hasOwnProperty.call(g,"bindstore")){a=this;d=arguments[1].toString();f=arguments[2];if(e){if(arguments[3] instanceof Array&&arguments[3].length){c=arguments[3]}else{b()}}}else{b()}}else{b()}if(Object.prototype.hasOwnProperty.call(g.propstore,d)){delete g.propstore[d];delete g.bindstore[d]}Object.defineProperties(g.propstore[d]={},{value:this.explicitNonConfigurable(e?f.bind(g.bindstore):f),previousValue:this.explicitNonConfigurable(e?null:f),dependencies:this.explicitNonConfigurable(e?c:null)});Object.defineProperty(g.bindstore,d,{configurable:true,enumerable:true,get:(function(){return(g.propstore[this].value)}).bind(d),set:(function(h){if(Object.getOwnPropertyNames(g.propstore[this]).sort().toString()!==a.storeMemberKeys){console.log("Unexpected format for propstore.")}else{if(h!==g.propstore[this].value){g.propstore[this].previousValue=g.propstore[this].value;g.propstore[this].value=h;a.updateDataBindings(g,this.toString())}}}).bind(d)})})}},updateDataBindings:{configurable:false,enumerable:false,get:function(){return(function(){if(arguments.length!==2||!(typeof arguments[0]==="object"||arguments[0]===dbind)||typeof arguments[1]!=="string"){throw new TypeError("'updateDataBindings' unexpected arguments.")}var a=arguments[0],h=arguments[1].toString(),k=Object.keys(a.propstore),j=k.length,g,d,b;try{for(var c=0;c<j;c++){g=k[c];d=a.propstore[g];b=d.dependencies;if(b!==null&&b.indexOf(h)!==-1){if(a.settings.mergeUpdates){if(a.updateQueue.indexOf(d.value)===-1){a.updateQueue.push(d.value)}}else{d.value()}}}a.propstore[h].previousValue=a.propstore[h].value}catch(f){console.log("Error while updating bindings depending on "+h+" - "+f.message)}})}},reset:{configurable:false,enumerable:false,get:function(){return(function(){var b=arguments[0]||dbind,a=this||dbind.prototype;if(!Object.prototype.hasOwnProperty.call(b,"settings")){throw new TypeError("'Reset' called on incompatible object.")}a.defaultRuntime(b)})}},pause:{configurable:false,enumerable:false,get:function(){return(function(){var a=arguments[0]||dbind;if(!Object.prototype.hasOwnProperty.call(a,"settings")){throw new TypeError("'Pause' called on incompatible object.")}a.settings.pause=true})}},resume:{configurable:false,enumerable:false,get:function(){return(function(){var b=arguments[0]||dbind,a=this||dbind.prototype;if(!Object.prototype.hasOwnProperty.call(b,"settings")){throw new TypeError("'Resume' called on incompatible object.")}b.settings.pause=false;a.refresh(b)})}},refresh:{configurable:false,enumerable:false,get:function(){return(function(){var a,j,k,h,d,g,b;a=arguments[0]||dbind;j=this||dbind.prototype;b=a.settings.pause;a.settings.pause=false;try{k=Object.keys(a.propstore);h=k.length;for(var c=0;c<h;c++){g=k[c];d=a.propstore[g];if(d.dependencies===null&&d.value!==d.previousValue){j.updateDataBindings(a,g)}}if(a.settings.mergeUpdates){j.runUpdateQueue(a)}}catch(f){console.log('Error with "refresh": ',f.message)}finally{a.settings.pause=b}})}},update:{configurable:false,enumerable:false,get:function(){return(function(){this.constructor.apply(this,arguments)})}}})}).call(dbind.prototype);(function(){var a=this.prototype;Object.defineProperties(this,{settings:a.explicitNonConfigurable({mergeUpdates:true,pause:false}),updateQueue:a.explicitNonConfigurable([]),bindstore:a.explicitNonConfigurable({}),propstore:a.explicitNonConfigurable({})});this.update=function(){this.apply(a,arguments)};this.reset=function(){this.prototype.reset.apply(a,arguments)};this.pause=function(){this.prototype.pause.apply(a,arguments)};this.refresh=function(){this.prototype.refresh.apply(a,arguments)};this.resume=function(){this.prototype.resume.apply(a,arguments)}}).call(dbind);Object.seal(dbind.prototype);Object.seal(dbind);if(nodeEnv){exports.dbind=dbind;exports.testNodeLib=function(){console.log("DBindJS running A OK on NodeJS.")}};